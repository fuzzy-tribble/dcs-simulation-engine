name: Infer Intent
version: 1.0.0
authors:
  - DCS
description: |
  A game where players engage with a human character and then report what goal the NPC was trying to communicate. It is useful for measuring how quickly in a single interaction with no background a player can understand the intention of another character as that characters abilities changes.
access_settings:
  user:
    valid:
      players:
        where:
          consent_signature.answer:
            "$exists": true
  new_player_form:
    preamble: |
      # Informed Consent for Research Study Participation

      You are being asked to be a volunteer in a research study. You may not participant if you are under 18-years-old or located outside of the United States. The purpose of this study is to assess oneâ€™s ability to infer goals of various simulated cognitive systems, including humans and AI. You will be asked to interact with an unknown cognitive system and attempt to infer its goals. It will take approximately an hour to complete.

      Identifiable information is only collected for voluntary follow-up; it is otherwise anonymous. Any identifiable information will be coded. The risks involved are no greater than those involved in daily activities. You will receive one SONA credit for this study.    

      We will comply with any applicable laws and regulations regarding confidentiality. To make sure that this research is being carried out in the proper way, the Georgia Institute of Technology IRB may review study records. The Office of Human Research Protections may also look at study records. If you have any questions about the study, you may contact dcs@psych.gatech.edu
      
      If you have any questions about your rights as a research subject, you may contact Georgia Institute of Technology Office of Research Integrity Assurance at IRB@gatech.edu. Thank you for participating in this study.
    questions:
      - key: full_name
        type: text
        placeholder: Jane Doe
        label: Full Name
        info: The name you'd like us to associate with your responses.
        required: true
        pii: true
      - key: email
        type: email
        label: Email address
        required: true
        pii: true
      - key: phone_number
        type: phone
        label: Phone number
        required: true
        pii: true
      - key: prior_experience
        type: textarea
        label: Explain any prior experience or expertise you have had working with non-standard humans or other cognitive agents?
        info: This includes personal or professional experience engaging with neurodivergent individuals or with humans or others who have atypical or unique cognitive abilities. For example, animal trainers, microbiologists working with yeast, special education teachers, biologists studying dophin behavior, etc.
        pii: false
      - key: additional_comments
        type: textarea
        label: Any additional comments or questions?
        required: false
        info: Optional feedback for the research team. Please do not include any identifiable information here.
      - key: consent_to_followup
        label: Follow-ups
        type: checkboxes
        options: 
          - I consent to being contacted for a voluntary follow-up regarding this study.
        required: false
      - key: consent_signature
        label: Consent Signature
        type: checkboxes
        options:
          - I confirm that the information I have provided is true and accurate. I acknowledge that I have read and understand the research consent information above, and I agree to participate. I understand that checking this box constitutes my electronic signature.
        required: true
data_collection_settings:
  save_runs: true
character_settings:
  display_pc_choice_as: "{hid} - {short_description}"
  display_npc_choice_as: "Character details hidden"
  pc:
    valid:
      characters:
        where:
          hid: "human-normative"
  npc:
    valid:
      characters:
        where: # character hid isn't human-normative
          hid:
            "$ne": "human-normative"
    invalid: # invalid where this player has already played this game with this character
      runs:
        where:
          player_id: player_id
          game_config.name: "Infer Intent"
          context.npc.hid: context.npc.hid

        
stopping_conditions:
  turns: [">=30"]
subgraph_customizations:
  additional_updater_rules: |
    - Goal Aligned Response: The simulator character's response should be in-line with a specific goal or intention that s/he/it/they are trying to communicate with the user character.
graph_config:
  name: inter-intent-graph
  description: A game flow graph that sets up and continues a scene where the system character is using their abilities to communicate a goal/intention. When the player thinks they understand the goal they can use the "guess" command to end the game and submit their inference. 
  state_overrides:
    user_retry_budget: 3
    forms:
      completion_form:
        questions:
          - key: user_goal_inference
            text: |
              What do you think the NPC's goal or intention was during this interaction? Please describe in a few sentences.
            answer: ''
          - key: other_feedback
            text: |
              Do you have any other feedback about this experience?
            answer: ''
  nodes:
    # command builtin func takes command to match "eg. help" and a message to display and/or states updates. It checks for a match in event_draft.content
    - name: command_filter
      kind: builtin.command_filter 
      kwargs:
        command_handlers:
          help:
            simulator_output:
              type: info
              content: |
                ##### Objective
                Your task in this simulation is use your abilities to interact with another character and figure the the intention or goal they are trying to communicate. When you feel like you understand their goal, type "/guess" to end the interaction and submit your inference.
                
                ##### Rules
                Describe an action that makes sense in the context of the scene and uses your character's abilities.
                - For example, if your character can see and move in a human-like way, you might say "I look around the room and walk to the door."

                ##### Commands
                Type '/help' to see this message again.
                Type '/guess' when you think you understand the NPC's goal to end the interaction and submit your inference.
                Type '/exit' or '/quit' to leave the game without submitting an inference.
                Type '/abilities' to see your character's abilities.
          abilities:
            simulator_output:
              type: info
              content: |
                ##### User Character Abilities
                {{ pc.abilities }}
          guess:
            lifecycle: COMPLETE
    - name: enter_message
      kind: builtin.update_state
      kwargs:
        state_updates:
          simulator_output:
            type: info
            content: |
              Welcome, in this game, you take on the role of a character whose aim is to use your abilities to interact with another character and figure the the intention or goal they are trying to communicate. When you feel like you understand their goal, type "/guess" to end the interaction and submit your inference.

              Your character is: {{ pc.short_description }} {% if pc.hid != "human-normative" %}\nAbilities:\n{{ pc.abilities }}{% endif %}

              For help at any time, type "/help"
          lifecycle: UPDATE
    - name: exit_message
      kind: builtin.update_state
      kwargs:
        state_updates:
          simulator_output:
            type: info
            content: |
              Game exited with reason: {{ exit_reason }}
    - name: complete_message
      kind: builtin.update_state
      kwargs:
        state_updates:
          simulator_output:
            type: info
            content: |
              Game Completed after {{ len(history) }} turns.
    # form builtin loops through each question in the form and displays it to the user to collect responses asking after submissions and before final save if they want to edit any responses.
    - name: completion_form
      kind: builtin.form 
      kwargs:
        form_name: completion_form
    - name: error_in_lifecycle
      kind: builtin.raise_error # error builtin funct takes a message: str and raises an error with that message.
      kwargs:
        message: |
          An unhandled lifecycle status was reached: {{ lifecycle }}
  edges:
    - from: __START__
      to: 
        conditional:
          - if: "state['simulator_output']"
            then: __END__
          - if: "state['lifecycle'] == 'ENTER'"
            then: enter_message
          - if: "state['lifecycle'] == 'EXIT'"
            then: exit_message
          - if: "state['lifecycle'] == 'COMPLETE'"
            then: completion_form
          - if: "state['lifecycle'] == 'UPDATE'"
            then: command_filter
          - else: error_in_lifecycle
    
    - from: enter_message
      to: __SIMULATION_SUBGRAPH__

    - from: exit_message
      to: __END__

    - from: command_filter
      to: 
        conditional:
          - if: "state['simulator_output']"
            then: __END__
          - if: "state['lifecycle'] == 'COMPLETE'"
            then: completion_form
          - else: __SIMULATION_SUBGRAPH__

    - from: completion_form
      to:
        conditional:
          - if: "state['lifecycle'] == 'EXIT'"
            then: exit_message
          - else: __END__